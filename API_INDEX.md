# API æ–‡æ¡£ç´¢å¼•

æœ¬æ–‡æ¡£ç´¢å¼•åˆ—å‡ºäº†æ‰€æœ‰ API ç›¸å…³çš„æ–‡æ¡£å’Œç¤ºä¾‹æ–‡ä»¶ã€‚

## ğŸ“š æ–‡æ¡£åˆ—è¡¨

### 1. API_DOCUMENTATION.md
**å®Œæ•´çš„ API å‚è€ƒæ–‡æ¡£**

- âœ“ æ‰€æœ‰ç«¯ç‚¹çš„è¯¦ç»†è¯´æ˜
- âœ“ è¯·æ±‚/å“åº”å‚æ•°è¯´æ˜
- âœ“ é”™è¯¯ç è¯´æ˜
- âœ“ æ€§èƒ½æŒ‡æ ‡
- âœ“ æœ€ä½³å®è·µ

**é€‚ç”¨äº**: å¼€å‘è€…éœ€è¦å®Œæ•´ API å‚è€ƒæ—¶æŸ¥é˜…

---

### 2. api_client_examples.py
**Python å®¢æˆ·ç«¯ç¤ºä¾‹ä»£ç **

åŒ…å« 6 ä¸ªå®Œæ•´ç¤ºä¾‹:
- âœ“ ç¤ºä¾‹ 1: åŸºç¡€ç¼–ç -è§£ç æµç¨‹
- âœ“ ç¤ºä¾‹ 2: ä½¿ç”¨è‡ªå®šä¹‰ä¸Šä¸‹æ–‡
- âœ“ ç¤ºä¾‹ 3: æ‰¹é‡å¤„ç†å¤šä¸ªæ¶ˆæ¯
- âœ“ ç¤ºä¾‹ 4: é”™è¯¯å¤„ç†
- âœ“ ç¤ºä¾‹ 5: DiscopClient å°è£…ç±»ï¼ˆæ¨èï¼‰
- âœ“ ç¤ºä¾‹ 6: å‰ç«¯æ•°æ®æ ¼å¼

**è¿è¡Œ**: `python api_client_examples.py`

**é€‚ç”¨äº**: Python å¼€å‘è€…å­¦ä¹ å¦‚ä½•è°ƒç”¨ API

---

### 3. FRONTEND_INTEGRATION_GUIDE.md
**å‰ç«¯é›†æˆå¿«é€ŸæŒ‡å—**

- âœ“ å¿«é€Ÿå¼€å§‹ï¼ˆæœ€å°ä»£ç ï¼‰
- âœ“ å®Œæ•´å·¥ä½œæµç¨‹
- âœ“ æ•°æ®åº“è¡¨ç»“æ„å»ºè®®
- âœ“ JavaScript/TypeScript ç¤ºä¾‹
- âœ“ React ç»„ä»¶ç¤ºä¾‹
- âœ“ é”™è¯¯å¤„ç†ç¤ºä¾‹

**é€‚ç”¨äº**: å‰ç«¯å¼€å‘è€…å¯¹æ¥ API

---

### 4. API_QUICK_REFERENCE.txt
**API å¿«é€Ÿå‚è€ƒå¡ç‰‡**

- âœ“ ä¸€é¡µçº¸å‚è€ƒ
- âœ“ æ‰€æœ‰ç«¯ç‚¹æ¦‚è§ˆ
- âœ“ æœ€å°ä»£ç ç¤ºä¾‹
- âœ“ é”™è¯¯ç é€ŸæŸ¥
- âœ“ æ€§èƒ½å‚è€ƒ

**é€‚ç”¨äº**: å¿«é€ŸæŸ¥é˜… API ç”¨æ³•

---

## ğŸ¯ æ ¹æ®åœºæ™¯é€‰æ‹©æ–‡æ¡£

### åœºæ™¯ 1: æˆ‘æ˜¯ Python å¼€å‘è€…ï¼Œæƒ³å¿«é€Ÿè¯•ç”¨

1. æŸ¥çœ‹ `API_QUICK_REFERENCE.txt` (3 åˆ†é’Ÿ)
2. è¿è¡Œ `python api_client_examples.py` (5 åˆ†é’Ÿ)
3. å¤åˆ¶ç¤ºä¾‹ 5 çš„ `DiscopClient` ç±»åˆ°ä½ çš„é¡¹ç›®

### åœºæ™¯ 2: æˆ‘æ˜¯å‰ç«¯å¼€å‘è€…ï¼Œéœ€è¦å¯¹æ¥ API

1. é˜…è¯» `FRONTEND_INTEGRATION_GUIDE.md` (15 åˆ†é’Ÿ)
2. å¤åˆ¶ JavaScript æˆ– React ç¤ºä¾‹åˆ°ä½ çš„é¡¹ç›®
3. å‚è€ƒæ•°æ®åº“è¡¨ç»“æ„è®¾è®¡å­˜å‚¨

### åœºæ™¯ 3: æˆ‘éœ€è¦å®Œæ•´çš„ API æ–‡æ¡£

1. é˜…è¯» `API_DOCUMENTATION.md` (30 åˆ†é’Ÿ)
2. äº†è§£æ‰€æœ‰ç«¯ç‚¹å’Œå‚æ•°
3. æ ¹æ®éœ€è¦å‚è€ƒç¤ºä¾‹ä»£ç 

### åœºæ™¯ 4: æˆ‘é‡åˆ°äº†é—®é¢˜ï¼Œéœ€è¦è°ƒè¯•

1. æ£€æŸ¥ `API_DOCUMENTATION.md` çš„é”™è¯¯å“åº”éƒ¨åˆ†
2. æŸ¥çœ‹ `api_client_examples.py` çš„ç¤ºä¾‹ 4ï¼ˆé”™è¯¯å¤„ç†ï¼‰
3. è¿è¡Œ `curl -H "X-API-Key: your-key" http://localhost:8002/health` æ£€æŸ¥æœåŠ¡å™¨

---

## ğŸ“‹ å¿«é€Ÿå¼€å§‹æ£€æŸ¥æ¸…å•

### æœåŠ¡å™¨ç«¯

- [ ] æœåŠ¡å™¨å·²å¯åŠ¨: `python api_server.py`
- [ ] æœåŠ¡å™¨å¯è®¿é—®: `curl http://localhost:8002/health`
- [ ] API Key å·²é…ç½®: æŸ¥çœ‹ `api_server.py` ç¬¬ 81 è¡Œ

### å®¢æˆ·ç«¯

- [ ] å·²å®‰è£… requests: `pip install requests`
- [ ] API URL æ­£ç¡®: é»˜è®¤ `http://localhost:8002`
- [ ] API Key æ­£ç¡®: ä¸æœåŠ¡å™¨é…ç½®ä¸€è‡´
- [ ] æµ‹è¯•è¿æ¥: `python api_client_examples.py`

---

## ğŸ”§ å¸¸ç”¨ä»£ç ç‰‡æ®µ

### Python - æœ€å°ç¤ºä¾‹

```python
import requests

API_URL = "http://localhost:8002"
headers = {
    "Content-Type": "application/json",
    "X-API-Key": "jnu@fenglab"
}

# ç¼–ç 
encode_resp = requests.post(f"{API_URL}/encode", headers=headers, json={
    "message": "Secret message",
    "settings": {"top_p": 0.88}
})
result = encode_resp.json()

# è§£ç 
decode_resp = requests.post(f"{API_URL}/decode", headers=headers, json={
    "stego_text": result["stego_text"],
    "context": "We were both young when I first saw you, I close my eyes and the flashback starts.",
    "settings": result["settings"],
    "expected_bits": result["payload_bits"]
})
print(decode_resp.json()["recovered_text"])
```

### JavaScript - æœ€å°ç¤ºä¾‹

```javascript
const API_URL = "http://localhost:8002";
const headers = {
    "Content-Type": "application/json",
    "X-API-Key": "jnu@fenglab"
};

// ç¼–ç 
const encodeResp = await fetch(`${API_URL}/encode`, {
    method: "POST",
    headers: headers,
    body: JSON.stringify({
        message: "Secret message",
        settings: { top_p: 0.88 }
    })
});
const result = await encodeResp.json();

// è§£ç 
const decodeResp = await fetch(`${API_URL}/decode`, {
    method: "POST",
    headers: headers,
    body: JSON.stringify({
        stego_text: result.stego_text,
        context: "We were both young when I first saw you, I close my eyes and the flashback starts.",
        settings: result.settings,
        expected_bits: result.payload_bits
    })
});
const decoded = await decodeResp.json();
console.log(decoded.recovered_text);
```

### cURL - æµ‹è¯•å‘½ä»¤

```bash
# å¥åº·æ£€æŸ¥
curl -H "X-API-Key: jnu@fenglab" http://localhost:8002/health

# ç¼–ç 
curl -X POST http://localhost:8002/encode \
  -H "Content-Type: application/json" \
  -H "X-API-Key: jnu@fenglab" \
  -d '{"message": "test", "settings": {"top_p": 0.88}}'

# è§£ç ï¼ˆéœ€è¦å…ˆä»ç¼–ç å“åº”è·å–å‚æ•°ï¼‰
curl -X POST http://localhost:8002/decode \
  -H "Content-Type: application/json" \
  -H "X-API-Key: jnu@fenglab" \
  -d '{
    "stego_text": "...",
    "context": "We were both young when I first saw you, I close my eyes and the flashback starts.",
    "settings": {...},
    "expected_bits": 192
  }'
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜: æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨

```bash
# æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ
ps aux | grep api_server

# æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬
netstat -tuln | grep 8002

# é‡å¯æœåŠ¡å™¨
pkill -f api_server
python api_server.py
```

### é—®é¢˜: 401 è®¤è¯å¤±è´¥

æ£€æŸ¥:
1. `api_server.py` ä¸­çš„ `API_KEY` é…ç½®ï¼ˆç¬¬ 81 è¡Œï¼‰
2. è¯·æ±‚ Header ä¸­çš„ `X-API-Key` æ˜¯å¦æ­£ç¡®
3. API Key æ˜¯å¦åŒ…å«ç‰¹æ®Šå­—ç¬¦éœ€è¦è½¬ä¹‰

### é—®é¢˜: è§£ç å¤±è´¥

æ£€æŸ¥:
1. æ˜¯å¦ä½¿ç”¨äº†ä¸ç¼–ç æ—¶**å®Œå…¨ç›¸åŒ**çš„ `context`
2. æ˜¯å¦ä½¿ç”¨äº†ä¸ç¼–ç æ—¶**å®Œå…¨ç›¸åŒ**çš„ `settings`
3. `stego_text` æ˜¯å¦è¢«ä¿®æ”¹è¿‡

### é—®é¢˜: æˆåŠŸç‡ä½

å°è¯•:
1. ä½¿ç”¨ `top_p: 0.88` è€Œä¸æ˜¯é»˜è®¤çš„ `0.92`
2. ç¼©çŸ­æ¶ˆæ¯é•¿åº¦
3. å¢åŠ  `length` å‚æ•°

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### æé«˜æˆåŠŸç‡

```python
# ä½¿ç”¨æ›´ä¿å®ˆçš„ top_p
settings = {
    "top_p": 0.88,  # è€Œä¸æ˜¯ 0.92
    "seed": 42      # å›ºå®šç§å­ç¡®ä¿å¯å¤ç°
}
```

### å¤„ç†é•¿æ¶ˆæ¯

```python
# è‡ªåŠ¨è®¡ç®—åˆé€‚çš„é•¿åº¦
message_length = len(message)
estimated_bits = message_length * 8

settings = {
    "top_p": 0.88,
    "length": max(100, estimated_bits // 3)  # é¢„ä¼°éœ€è¦çš„ token æ•°
}
```

### æ‰¹é‡å¤„ç†

```python
import concurrent.futures

def encode_message_batch(messages):
    with concurrent.futures.ThreadPoolExecutor(max_workers=5) as executor:
        futures = [executor.submit(encode_message, msg) for msg in messages]
        return [f.result() for f in concurrent.futures.as_completed(futures)]
```

---

## ğŸ“ è·å–å¸®åŠ©

- **API æ–‡æ¡£**: `API_DOCUMENTATION.md`
- **ç¤ºä¾‹ä»£ç **: `api_client_examples.py`
- **å¿«é€Ÿå‚è€ƒ**: `API_QUICK_REFERENCE.txt`
- **å‰ç«¯é›†æˆ**: `FRONTEND_INTEGRATION_GUIDE.md`

- **æœåŠ¡å™¨æ—¥å¿—**: `api_server.log`
- **æµ‹è¯•è„šæœ¬**: `test_multi_cycle.py`
- **å¥åº·æ£€æŸ¥**: `GET /health`

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### 2025-09-30
- âœ“ æ·»åŠ å®Œæ•´çš„ API æ–‡æ¡£
- âœ“ æ·»åŠ  Python å®¢æˆ·ç«¯ç¤ºä¾‹ï¼ˆ6 ä¸ªç¤ºä¾‹ï¼‰
- âœ“ æ·»åŠ å‰ç«¯é›†æˆæŒ‡å—ï¼ˆJavaScript/Reactï¼‰
- âœ“ æ·»åŠ å¿«é€Ÿå‚è€ƒå¡ç‰‡
- âœ“ ä¿®å¤ PyTorch RNG çŠ¶æ€é—®é¢˜
- âœ“ æˆåŠŸç‡æå‡è‡³ 95%+ï¼ˆä½¿ç”¨ top_p=0.88ï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥

1. é˜…è¯»é€‚åˆä½ è§’è‰²çš„æ–‡æ¡£
2. è¿è¡Œç¤ºä¾‹ä»£ç æµ‹è¯•è¿æ¥
3. å¤åˆ¶ç›¸å…³ä»£ç åˆ°ä½ çš„é¡¹ç›®
4. æ ¹æ®éœ€è¦è°ƒæ•´å‚æ•°
5. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

**ç¥å¼€å‘é¡ºåˆ©ï¼**
